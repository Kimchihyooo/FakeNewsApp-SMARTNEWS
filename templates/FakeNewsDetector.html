<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CredibilityScan Detector</title>
    
    <link rel="stylesheet" href="../static/css/FakeNewsDetectorStyle.CSS" />
    
    <link href="https://fonts.googleapis.com/css2?family=Geo:ital@0;1&family=Oswald:wght@200..700&family=Rubik:ital,wght@0,300;1,300&display=swap" rel="stylesheet">
    <style>
        /* Simple style for video error box */
        .video-error-box {
            background-color: #fee2e2;
            color: #b91c1c;
            border: 1px solid #fca5a5;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }
        /* Style for transcription box */
        .transcription-box {
            max-height: 150px; 
            overflow-y: auto; 
            background: #f8f9fa; 
            padding: 12px; 
            border-radius: 8px;
            border: 1px solid #e9ecef;
            font-family: monospace;
            font-size: 0.9rem;
            color: #343a40;
            line-height: 1.5;
            margin-top: 8px;
        }
        
        /* --- LIME HIGHLIGHTS (TEXT) --- */
        .lime-good {
            background-color: #dcfce7 !important; /* Force Light Green */
            color: #166534 !important;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 500;
        }
        .lime-bad {
            background-color: #fee2e2 !important; /* Force Light Red */
            color: #991b1b !important;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 500;
        }

        /* --- LEGEND BOXES (SQUARES) --- */
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        .legend-color-box {
            width: 20px;
            height: 20px;
            display: inline-block;
            border-radius: 4px;
            margin-right: 10px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .legend-good {
            background-color: #dcfce7 !important; /* Green */
        }
        .legend-bad {
            background-color: #fee2e2 !important; /* Red */
        }

        /* Link styles */
        .clear-analysis-link {
            display: inline-block;
            margin-top: 12px;
            font-size: 0.9rem;
            color: #2563eb;
            text-decoration: none;
            font-weight: 500;
        }
        .clear-analysis-link:hover {
            text-decoration: underline;
        }
        
        #results-area {
            display: none; 
        }

        /* --- SCANNER ANIMATION (New) --- */
        @keyframes scan-beam {
            0% { background-position: 0 -200px; }
            100% { background-position: 0 calc(100% + 200px); }
        }

        .scanning {
            background-image: linear-gradient(to bottom, 
                rgba(255, 255, 255, 0) 0%, 
                rgba(37, 99, 235, 0.2) 50%, 
                rgba(255, 255, 255, 0) 100%) !important;
            
            background-color: #ffffff !important;
            background-size: 100% 200px !important;
            background-repeat: no-repeat !important;
            animation: scan-beam 2s linear infinite !important;
            
            border-color: #2563eb !important;
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.2) !important;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>

    <header class="navbar">
        <div class="logo">
            <h1>CredibilityScan</h1>
        </div>
        <input type="checkbox" id="nav-toggle" class="nav-toggle">
        <label for="nav-toggle" class="nav-toggle-label">
            <span></span>
        </label>
        <nav class="nav-menu">
            <div class="bordnav">
                <a href="/">Home</a>
                <a href="detector">Detector</a>
                <a href="about">How to Use?</a>
            </div>
        </nav>
    </header>

    <div class="detector-container">
    
        <div class="main-content-wrapper">

            <div class="input-column">
                <div class="input-tab-bar" role="tablist" aria-label="Input mode tabs">
                    <button class="tab tab-active" data-mode="text" type="button" aria-selected="true">Text</button>
                    <button class="tab" data-mode="video" type="button" aria-selected="false">Video</button>
                </div>

                <form id="analyzeForm" class="form">
                    <div class="mode mode-text">
                        <textarea id="userInput" name="news_text" class="detector-textarea" 
                            placeholder="Paste your news article text here to analyze..." required></textarea>
                            
                        <div id="word-counts" class="word-count">0 words</div>

                        <button type="submit" class="detector-btn" id="btntext" style="margin-top: 20px;">Analyze</button>
                    </div>
                
                    <div class="mode mode-video" style="display:none;">
                        <label for="video-url" class="detector-label">Video</label>
                        <input id="videoUrlInput" name="video_url" type="url" class="detector-textarea" 
                            placeholder="https://www.youtube.com/watch?v=..." />
                        
                        <div id="videoPreview" class="video-preview" aria-live="polite"></div>

                        <button type="submit" class="detector-btn" id="btnvid">Analyze Video</button>
                    </div>

                    <div id="timer-display" style="display:none; text-align:center; margin-top:15px; font-family: monospace; font-size: 0.95rem; color: #666;">
                        Processing: 0.00s
                    </div>

                </form>
            </div> 

            <div class="results-column">

                <button type="button" class="history-trigger-btn" id="history-trigger-btn">
                    View Recent Analysis
                </button>

                <div id="results-placeholder" class="results-placeholder">
                    <h3>Results will appear here</h3>
                    <p>Enter your text or video URL on the left and click "Analyze" to see the credibility assessment.</p>
                </div>

                <div id="results-area">
                    <div class="results-content">
                        <h2 style="font-family: 'Rubik', sans-serif; font-weight: 600; margin-top: 0;">Analysis Result</h2>

                        <div class="score-box" id="scoreBox" style="background-color: #f8f9fa; padding: 24px; border-radius: 8px; margin-bottom: 20px;">
                            <h3 class="score" id="verdict-label" style="font-size: 2.25rem; margin-bottom: 8px;">--</h3>
                        </div>

                        <div class="classification" id="classifications" style="background-color: #f0f0f0; border-left: 5px solid #ccc; padding: 10px;">
                            Most Likely <strong id="classification-text">--</strong><br>
                            Confidence: <span id="confidence-score">0%</span>
                        </div>

                        <div style="margin-top: 20px;">
                            <div id="result-container" class="detector-textarea" style="overflow-y: auto; line-height: 1.6; height: auto; min-height: 200px; background: white; border: 1px solid #ddd;">
                                </div>

                            <div class="legend-box" style="margin-top: 10px;">
                                <h4>What the Colors Mean</h4>
                                <div class="legend-item">
                                    <div class="legend-color-box legend-bad"></div>
                                    <span>= Words often associated with FAKE news.</span>
                                </div>
                            </div>
                        </div>

                        <div class="sources" style="margin-top: 20px;">
                            <h3>Supporting Sources</h3>
                            <div id="sources-list">
                                </div>
                        </div>
                    </div>
                </div> </div> 
        </div> 
    </div> 

    <div class="modal-overlay" id="history-modal-overlay">
        <div class="modal-content">
            <div class="history-container">
                <div class="modal-header" style="flex-direction: column; align-items: stretch; gap: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>Recent Analysis</h3>
                        <button class="modal-close-btn" id="history-close-btn">&times;</button>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <select id="history-filter-select" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: #f8f9fa; cursor: pointer; font-family: 'Rubik', sans-serif;">
                            <option value="all">All History</option>
                            <option value="saved">‚≠ê Saved / Favorites</option>
                            <option value="real">Verdicts: Real / Credible</option>
                            <option value="fake">Verdicts: Fake / Low Credibility</option>
                            <option value="uncertain">Verdicts: Uncertain</option>
                            <option value="text">Type: Text Articles</option>
                            <option value="video">Type: Videos</option>
                        </select>
                        <input type="text" id="history-search-input" placeholder="Search keywords..." 
                            style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Rubik', sans-serif;">
                    </div>
                </div>
                <div id="history-list" class="history-list">
                    <p class="history-empty">Your analysis history will appear here.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
    (function(){
        // === 1. TAB SWITCHING LOGIC ===
        const bar = document.querySelector('.input-tab-bar');
        const tabs = Array.from(document.querySelectorAll('.tab'));
        const textMode = document.querySelector('.mode-text');
        const videoMode = document.querySelector('.mode-video');
        const analyzeForm = document.getElementById('analyzeForm');
        
        const textInput = document.getElementById('userInput');
        const videoInput = document.getElementById('videoUrlInput');

        if(bar && tabs.length && textMode && videoMode && analyzeForm){
            function setMode(mode){
                tabs.forEach(t => {
                    const active = t.getAttribute('data-mode') === mode;
                    t.classList.toggle('tab-active', active);
                    t.setAttribute('aria-selected', active ? 'true' : 'false');
                });
                
                if(mode === 'video'){
                    textMode.style.display = 'none';
                    videoMode.style.display = 'block';
                    analyzeForm.setAttribute('action', '/analyze-video'); 
                    if(textInput) textInput.required = false;
                    if(videoInput) videoInput.required = true;
                } else { 
                    textMode.style.display = 'block';
                    videoMode.style.display = 'none';
                    analyzeForm.setAttribute('action', '/analyze'); 
                    if(textInput) textInput.required = true;
                    if(videoInput) videoInput.required = false;
                }
            }
            tabs.forEach(t => t.addEventListener('click', () => setMode(t.getAttribute('data-mode'))));
            setMode('text'); // Default
        }

        // === 2. HISTORY MODAL TOGGLE ===
        const historyTrigger = document.getElementById('history-trigger-btn');
        const modalOverlay = document.getElementById('history-modal-overlay');
        const modalCloseBtn = document.getElementById('history-close-btn');

        if (historyTrigger && modalOverlay && modalCloseBtn) {
            historyTrigger.addEventListener('click', () => modalOverlay.classList.add('modal-active'));
            modalCloseBtn.addEventListener('click', () => modalOverlay.classList.remove('modal-active'));
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) modalOverlay.classList.remove('modal-active');
            });
        }

        // === 3. WORD COUNTER ===
        const countDisplay = document.getElementById('word-counts');
        const btnText = document.getElementById('btntext'); 
        
        function updateCounter(){
            if (!textInput || !countDisplay) return;
            const text = textInput.value.trim();
            const count = text ? text.split(/\s+/).filter(word => word.length > 0).length : 0;
            
            if (count > 250) {
                countDisplay.innerText = count + " / 250 words (Limit exceeded)";
                countDisplay.style.color = "#dc2626";
                if(btnText) {
                    btnText.disabled = true;
                    btnText.style.opacity = "0.5";
                    btnText.style.cursor = "not-allowed";
                }
            } else {
                countDisplay.innerText = count + " / 250 words";
                countDisplay.style.color = "#6c757d";
                if(btnText) {
                    btnText.disabled = false;
                    btnText.style.opacity = "1";
                    btnText.style.cursor = "pointer";
                }
            }
        }
        if(textInput) {
            textInput.addEventListener('input', updateCounter);
            updateCounter();
        }
    })();
    </script>

    <script src="../static/js/main.js"></script>

</body>
</html>