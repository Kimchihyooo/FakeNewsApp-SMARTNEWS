<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CredibilityScan Detector</title>
    
    <link rel="stylesheet" href="../static/css/FakeNewsDetectorStyle.CSS" />
    
    <link href="https://fonts.googleapis.com/css2?family=Geo:ital@0;1&family=Oswald:wght@200..700&family=Rubik:ital,wght@0,300;1,300&display=swap" rel="stylesheet">
    <style>
        /* --- LEGEND BOXES --- */
        .legend-item { display: flex; align-items: center; margin-bottom: 8px; }
        .legend-color-box { width: 20px; height: 20px; display: inline-block; border-radius: 4px; margin-right: 10px; border: 1px solid rgba(0,0,0,0.1); }
        .legend-good { background-color: #dcfce7 !important; }
        .legend-bad { background-color: #fee2e2 !important; }

        /* --- LIME HIGHLIGHTS --- */
        .lime-good { background-color: #dcfce7 !important; color: #166534 !important; padding: 2px 4px; border-radius: 4px; font-weight: 500; }
        .lime-bad { background-color: #fee2e2 !important; color: #991b1b !important; padding: 2px 4px; border-radius: 4px; font-weight: 500; }

        /* --- SCANNER ANIMATION --- */
        @keyframes scan-beam { 0% { background-position: 0 -200px; } 100% { background-position: 0 calc(100% + 200px); } }
        .scanning {
            background-image: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(37,99,235,0.2) 50%, rgba(255,255,255,0) 100%) !important;
            background-color: #ffffff !important;
            background-size: 100% 200px !important;
            background-repeat: no-repeat !important;
            animation: scan-beam 2s linear infinite !important;
            border-color: #2563eb !important;
            box-shadow: 0 0 15px rgba(37, 99, 235, 0.2) !important;
            transition: all 0.3s ease;
        }

        /* --- VIDEO GALLERY --- */
        .video-error-box { background-color: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5; border-radius: 8px; padding: 16px; margin-bottom: 20px; }
        .transcription-box { max-height: 150px; overflow-y: auto; background: #f8f9fa; padding: 12px; border-radius: 8px; border: 1px solid #e9ecef; font-family: monospace; font-size: 0.9rem; color: #343a40; line-height: 1.5; margin-top: 8px; }

        /* --- IMAGE MODAL (LIGHTBOX) STYLES --- */
        .image-modal-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 2000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .image-modal-content {
            margin: auto;
            display: block;
            max-width: 90%;
            max-height: 90%;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            animation: zoom 0.3s;
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            cursor: pointer;
            z-index: 2001;
        }

        .image-modal-close:hover,
        .image-modal-close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        @keyframes zoom {
            from {transform:scale(0.8); opacity: 0;}
            to {transform:scale(1); opacity: 1;}
        }
    </style>
</head>
<body>

    <header class="navbar">
        <div class="logo"><h1>CredibilityScan</h1></div>
        <input type="checkbox" id="nav-toggle" class="nav-toggle">
        <label for="nav-toggle" class="nav-toggle-label"><span></span></label>
        <nav class="nav-menu">
            <div class="bordnav">
                <a href="/">Home</a>
                <a href="detector">Detector</a>
                <a href="about">How to Use?</a>
            </div>
        </nav>
    </header>

    <div class="detector-container">
        <div class="main-content-wrapper">

            <div class="input-column">
                <div class="input-tab-bar" role="tablist" aria-label="Input mode tabs">
                    <button class="tab tab-active" data-mode="text" type="button" aria-selected="true">Text</button>
                    <button class="tab" data-mode="video" type="button" aria-selected="false">Video</button>
                </div>

                <form id="analyzeForm" class="form" action="/analyze" method="post">
                    <div class="mode mode-text">
                        <textarea id="userInput" name="news_text" class="detector-textarea" 
                            placeholder="Paste your news article text here to analyze..." required></textarea>
                        <div id="word-counts" class="word-count">0 words</div>
                        <button type="submit" class="detector-btn" id="btntext" style="margin-top: 20px;">Analyze</button>
                    </div>
                
                    <div class="mode mode-video" style="display:none;">
                        <label for="video-url" class="detector-label">Video URL</label>
                        <input id="videoUrlInput" name="video_url" type="url" class="detector-textarea" 
                            placeholder="https://www.youtube.com/watch?v=..." />                        
                        <button type="submit" class="detector-btn" id="btnvid">Analyze Video</button>
                    </div>

                    <div id="timer-display" style="display:none; text-align:center; margin-top:15px; font-family: monospace; font-size: 0.95rem; color: #666;">
                        Processing: 0.00s
                    </div>
                </form>
            </div> 

            <div class="results-column">

                <button type="button" class="history-trigger-btn" id="history-trigger-btn">View Recent Analysis</button>

                <div id="results-placeholder" class="results-placeholder">
                    <h3>Results will appear here</h3>
                    <p>Enter your text or video URL on the left and click "Analyze" to see the credibility assessment.</p>
                </div>

                <div id="results-area" style="display: none;">
                    <div class="results-content">
                        <h2 style="font-family: 'Rubik', sans-serif; font-weight: 600; margin-top: 0;">Analysis Result</h2>

                        <div class="score-box" id="scoreBox" style="background-color: #f8f9fa; padding: 24px; border-radius: 8px; margin-bottom: 20px;">
                            <h3 class="score" id="verdict-label" style="font-size: 2.25rem; margin-bottom: 8px;">--</h3>
                        </div>

                        <div class="classification" id="classifications" style="background-color: #f0f0f0; border-left: 5px solid #ccc; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px;">
                                <span>Model Confidence:</span>
                                <strong id="confidence-score">0%</strong>
                            </div>
                            <div style="background-color: rgba(0,0,0,0.1); height: 10px; border-radius: 5px; overflow: hidden;">
                                <div id="confidence-bar" style="width: 0%; height: 100%; background-color: #666; transition: width 1s ease-out;"></div>
                            </div>
                        </div>

                        <div id="text-results-container">
                            <div id="result-container" class="detector-textarea" style="overflow-y: auto; line-height: 1.6; height: auto; min-height: 200px; background: white; border: 1px solid #ddd;"></div>
                            
                            <div class="legend-box" style="margin-top: 10px;">
                                <div class="legend-item">
                                    <div class="legend-color-box legend-bad"></div>
                                    <span>Sentences flagged as highly suspicious.</span>
                                </div>
                            </div>

                            <div class="sources" style="margin-top: 20px;">
                                <h3>Supporting Sources</h3>
                                <div id="sources-list"></div>
                            </div>
                        </div>

                        <div id="video-results-container" style="display: none;">
                            
                            <div style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb; margin-bottom: 20px;">
                                <p id="video-interpretation" style="color: #4b5563; line-height: 1.6; margin-bottom: 0;">Analysis pending...</p>
                            </div>

                            <h4 style="color: #374151; margin-bottom: 10px;">Suspicious Frames (Click to Expand)</h4>
                            <div id="frame-gallery" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px;">
                                </div>

                            <details style="margin-top: 10px; border: 1px solid #eee; border-radius: 5px; padding: 10px;">
                                <summary style="cursor: pointer; font-weight: 500; color: #666;">View Full Transcript</summary>
                                <div id="video-transcript" class="transcription-box"></div>
                            </details>
                        </div>

                    </div>
                </div> 
            </div> 
        </div> 
    </div> 

    <div class="modal-overlay" id="history-modal-overlay">
        <div class="modal-content">
            <div class="history-container">
                <div class="modal-header" style="flex-direction: column; align-items: stretch; gap: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3>Recent Analysis</h3>
                        <button class="modal-close-btn" id="history-close-btn">&times;</button>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <select id="history-filter-select" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                            <option value="all">All History</option>
                            <option value="saved">‚≠ê Saved</option>
                            <option value="video">Videos</option>
                        </select>
                        <input type="text" id="history-search-input" placeholder="Search..." style="flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                    </div>
                </div>
                <div id="history-list" class="history-list">
                    <p class="history-empty">Your analysis history will appear here.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="image-modal-overlay" id="image-modal-overlay">
        <span class="image-modal-close" id="image-modal-close">&times;</span>
        <img class="image-modal-content" id="image-modal-img">
    </div>

    <script>
    (function(){
        // TAB SWITCHING
        const bar = document.querySelector('.input-tab-bar');
        const tabs = Array.from(document.querySelectorAll('.tab'));
        const textMode = document.querySelector('.mode-text');
        const videoMode = document.querySelector('.mode-video');
        const analyzeForm = document.getElementById('analyzeForm');
        const textInput = document.getElementById('userInput');
        const videoInput = document.getElementById('videoUrlInput');

        if(bar && tabs.length){
            function setMode(mode){
                tabs.forEach(t => {
                    const active = t.getAttribute('data-mode') === mode;
                    t.classList.toggle('tab-active', active);
                });
                if(mode === 'video'){
                    textMode.style.display = 'none';
                    videoMode.style.display = 'block';
                    analyzeForm.setAttribute('action', '/analyze-video'); 
                    if(textInput) textInput.required = false;
                    if(videoInput) videoInput.required = true;
                } else { 
                    textMode.style.display = 'block';
                    videoMode.style.display = 'none';
                    analyzeForm.setAttribute('action', '/analyze'); 
                    if(textInput) textInput.required = true;
                    if(videoInput) videoInput.required = false;
                }
            }
            tabs.forEach(t => t.addEventListener('click', () => setMode(t.getAttribute('data-mode'))));
            setMode('text');
        }

        // HISTORY MODAL TOGGLE
        const historyTrigger = document.getElementById('history-trigger-btn');
        const modalOverlay = document.getElementById('history-modal-overlay');
        const modalCloseBtn = document.getElementById('history-close-btn');

        if (historyTrigger && modalOverlay) {
            historyTrigger.addEventListener('click', () => modalOverlay.classList.add('modal-active'));
            modalCloseBtn.addEventListener('click', () => modalOverlay.classList.remove('modal-active'));
            modalOverlay.addEventListener('click', (e) => {
                if (e.target === modalOverlay) modalOverlay.classList.remove('modal-active');
            });
        }

        // WORD COUNTER
        const countDisplay = document.getElementById('word-counts');
        const btnText = document.getElementById('btntext'); 
        if(textInput && countDisplay) {
            textInput.addEventListener('input', () => {
                const count = textInput.value.trim().split(/\s+/).filter(w => w.length > 0).length;
                countDisplay.innerText = `${count} / 250 words`;
                if (count > 250) {
                    countDisplay.style.color = "red";
                    btnText.disabled = true;
                } else {
                    countDisplay.style.color = "#666";
                    btnText.disabled = false;
                }
            });
        }
    })();
    </script>

    <script src="../static/js/main.js"></script>

</body>
</html>