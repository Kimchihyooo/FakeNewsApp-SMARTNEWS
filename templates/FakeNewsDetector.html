<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CredibilityScan Detector</title>
    
    <link rel="stylesheet" href="../static/css/FakeNewsDetectorStyle.CSS" />
    <link href="https://fonts.googleapis.com/css2?family=Geo:ital@0;1&family=Oswald:wght@200..700&family=Rubik:ital,wght@0,300;1,300&display=swap" rel="stylesheet">
</head>
<body>

    <header class="navbar">
        <div class="logo"><h1>CredibilityScan</h1></div>
        <input type="checkbox" id="nav-toggle" class="nav-toggle">
        <label for="nav-toggle" class="nav-toggle-label"><span></span></label>
        <nav class="nav-menu">
            <div class="bordnav">
                <a href="/">Home</a>
                <a href="detector">Detector</a>
                <a href="about">How to Use?</a>
            </div>
        </nav>
    </header>

    <div class="detector-container">
        <div class="main-content-wrapper">

            <div class="input-column">
                <div class="input-tab-bar" role="tablist" aria-label="Input mode tabs">
                    <button class="tab tab-active" data-mode="text" type="button">Text Article</button>
                    <button class="tab" data-mode="video" type="button">Video Link</button>
                </div>

                <form id="analyzeForm" class="form" action="/analyze" method="post">
                    <div class="mode mode-text">
                        <label class="detector-label">News Content</label>
                        <textarea id="userInput" name="news_text" class="detector-textarea" 
                            placeholder="Paste the title and content of the article here..." required></textarea>
                        <div id="word-counts" class="word-count" style="text-align: right; margin-top: 5px; color: #64748b; font-size: 0.9rem;">0 words</div>
                        <button type="submit" class="detector-btn" id="btntext">Analyze</button>
                    </div>
                
                    <div class="mode mode-video" style="display:none;">
                        <label class="detector-label">Video URL</label>
                        <input id="videoUrlInput" name="video_url" type="url" class="detector-textarea" 
                            style="min-height: 60px; height: 60px;"
                            placeholder="Paste YouTube, TikTok, or Facebook link..." autocomplete="off" />
                        
                        <div id="video-preview-card" style="display: none;">
                            <div style="display: flex;">
                                <div style="width: 140px; height: 100px; background: #f1f5f9; flex-shrink: 0; position: relative;">
                                    <img id="preview-thumb" src="" style="width: 100%; height: 100%; object-fit: cover;" alt="Thumbnail">
                                    <span id="preview-duration" style="position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.8); color: #fff; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px;">0:00</span>
                                </div>
                                <div style="padding: 15px; display: flex; flex-direction: column; justify-content: center;">
                                    <h4 id="preview-title" style="margin: 0 0 5px 0; font-size: 1rem; color: #333; line-height: 1.3; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">Loading...</h4>
                                    <div style="font-size: 0.85rem; color: #64748b;">
                                        <span id="preview-author">Author</span> ‚Ä¢ <span id="preview-platform">Platform</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="detector-btn" id="btnvid">Analyze Video</button>
                    </div>

                    <div id="timer-display" style="display:none; text-align:center; margin-top:15px; font-family: monospace; font-size: 0.95rem; color: #64748b;">
                        Processing: 0.00s
                    </div>
                </form>
            </div> 

            <div class="results-column">

                <button type="button" class="history-trigger-btn" id="history-trigger-btn">
                    <span>üïí</span> View Recent Analysis
                </button>

                <div id="results-placeholder" class="results-placeholder">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <h3 style="color:#64748b; margin-top: 15px;">Ready to Scan</h3>
                    <p style="color:#94a3b8; max-width: 300px; margin: 0 auto;">Enter content on the left to begin the deepfake and text verification process.</p>
                </div>

                <div id="results-area" style="display: none;">
                    
                    <div class="score-box animate-enter delay-1" id="scoreBox">
                        <div style="font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; color: inherit; opacity: 0.8; margin-bottom: 5px;">Verdict</div>
                        <h3 class="score" id="verdict-label">--</h3>
                    </div>

                    <div class="classification animate-enter delay-2" id="classifications">
                        <div style="display: flex; justify-content: space-between; font-size: 0.95rem; margin-bottom: 8px; color: #475569;">
                            <span>AI Confidence</span>
                            <strong id="confidence-score">0%</strong>
                        </div>
                        <div class="confidence-track">
                            <div id="confidence-bar"></div>
                        </div>
                    </div>

                    <div class="animate-enter delay-3">
                        <h4 style="margin: 0 0 10px 0; color: #334155; font-family: 'Rubik', sans-serif;"></h4>
                        
                        <div id="text-results-container">
                            <div id="result-container" style="font-size: 0.95rem; line-height: 1.7; color: #334155;"></div>
                            
                            <div class="legend-box">
                                <div class="legend-item">
                                    <div class="legend-color-box legend-bad"></div>
                                    <span>Sentences flagged as highly suspicious.</span>
                                </div>
                            </div>

                            <div class="sources animate-enter delay-4" style="margin-top: 25px;">
                                <h3 style="font-size: 1.1rem; margin-bottom: 10px;">Supporting Sources</h3>
                                <div id="sources-list"></div>
                            </div>
                        </div>

                        <div id="video-results-container" style="display: none;">
                            <div style="background: #fff; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; margin-bottom: 20px;">
                                <p id="video-interpretation" style="color: #4b5563; margin: 0; line-height: 1.6;">Analysis pending...</p>
                            </div>
                            
                            <h5 style="color: #64748b; margin-bottom: 10px;">Suspicious Frames (Click to Expand)</h5>
                            <div id="frame-gallery" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px; margin-bottom: 20px;"></div>
                            
                            <div id="video-transcript-container" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e2e8f0;"></div>
                        </div>
                    </div>
                </div> 
            </div> 
        </div> 
    </div> 

    <div class="modal-overlay" id="history-modal-overlay">
        <div class="modal-content">
            <div class="history-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin:0;">Recent Analysis</h3>
                    <button id="history-close-btn" style="background:none; border:none; font-size: 1.5rem; cursor:pointer;">&times;</button>
                </div>
                
                <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <select id="history-filter-select" style="padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 40%;">
                        <option value="all">All History</option>
                        <option value="saved">‚≠ê Saved</option>
                        <option value="text">Text Articles</option>
                        <option value="video">Videos</option>
                    </select>
                    <input type="text" id="history-search-input" placeholder="Search keywords..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                </div>

                <div id="history-list" class="history-list">
                    <p class="history-empty" style="text-align: center; color: #999;">Your analysis history will appear here.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="image-modal-overlay" id="image-modal-overlay">
        <span class="image-modal-close" id="image-modal-close">&times;</span>
        <img class="image-modal-content" id="image-modal-img">
    </div>

    <script src="../static/js/main.js"></script>

    <script>
    (function(){
        // UI Elements
        const tabs = document.querySelectorAll('.tab');
        const textMode = document.querySelector('.mode-text');
        const videoMode = document.querySelector('.mode-video');
        const analyzeForm = document.getElementById('analyzeForm');
        
        // Inputs
        const textInput = document.getElementById('userInput');
        const videoInput = document.getElementById('videoUrlInput');
        
        // Results & Previews (To Clear)
        const resultsArea = document.getElementById('results-area');
        const placeholder = document.getElementById('results-placeholder');
        const videoPreview = document.getElementById('video-preview-card');
        const wordCountDisplay = document.getElementById('word-counts'); // NEW SELECTOR

        tabs.forEach(t => {
            t.addEventListener('click', () => {
                // 1. Activate Tab Visuals
                tabs.forEach(x => x.classList.remove('tab-active'));
                t.classList.add('tab-active');
                
                // 2. CLEAR ALL INPUTS
                if(textInput) {
                    textInput.value = "";
                    // NEW: Reset Word Count to 0
                    if(wordCountDisplay) wordCountDisplay.innerText = "0 words";
                }
                if(videoInput) videoInput.value = "";

                // 3. RESET RESULTS AREA (Hide old results, show placeholder)
                if(resultsArea) resultsArea.style.display = 'none';
                if(placeholder) placeholder.style.display = 'block';
                
                // 4. RESET VIDEO PREVIEW CARD
                if(videoPreview) videoPreview.style.display = 'none';
                
                // 5. SWITCH MODES
                const mode = t.getAttribute('data-mode');
                if(mode === 'video'){
                    textMode.style.display = 'none';
                    videoMode.style.display = 'block';
                    analyzeForm.setAttribute('action', '/analyze-video'); 
                    
                    if(textInput) textInput.required = false;
                    if(videoInput) videoInput.required = true;
                } else { 
                    textMode.style.display = 'block';
                    videoMode.style.display = 'none';
                    analyzeForm.setAttribute('action', '/analyze'); 
                    
                    if(textInput) textInput.required = true;
                    if(videoInput) videoInput.required = false;
                }
            });
        });

        // History Modal Logic
        const histBtn = document.getElementById('history-trigger-btn');
        const histModal = document.getElementById('history-modal-overlay');
        const histClose = document.getElementById('history-close-btn');
        
        if(histBtn && histModal) {
            histBtn.addEventListener('click', () => histModal.classList.add('modal-active'));
            if(histClose) histClose.addEventListener('click', () => histModal.classList.remove('modal-active'));
            histModal.addEventListener('click', (e) => {
                if(e.target === histModal) histModal.classList.remove('modal-active');
            });
        }
    })();
    </script>
</body>
</html>